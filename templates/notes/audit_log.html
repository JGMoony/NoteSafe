{% extends "base.html" %}
{% load i18n static %}

{% block head_title %}Historial de Auditoría{% endblock %}

{% block content %}
<div class="container container-lg py-6">

    <!-- Título -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-blue-600">{% translate "Historial de Actividad" %}</h1>
        <p class="text-muted">
            {% translate "Registro de acciones importantes, incluyendo gestión de notas y eventos de autenticación." %}
        </p>
    </div>

    <!-- Tarjeta principal -->
    <div class="card shadow-lg rounded-xl border border-blue-100 overflow-hidden">
        <div class="card-header bg-blue-50 px-6 py-4">
            <h2 class="card-title text-lg font-semibold text-blue-700">{% translate "Registro de Auditoría" %}</h2>
            <p class="card-description text-sm text-blue-600 mt-1">
                {% if logs %}
                    {% blocktranslate count logs_count=logs|length %}
                        {{ logs_count }} evento registrado
                    {% plural %}
                        {{ logs_count }} eventos registrados
                    {% endblocktranslate %}
                {% else %}
                    {% translate "Sin eventos registrados" %}
                {% endif %}
            </p>
        </div>

        <div class="card-body p-0">
            {% if logs %}
            <div class="overflow-x-auto">
                <table class="table w-full text-sm">
                    <thead class="bg-blue-100 text-blue-700">
                        <tr>
                            <th class="px-4 py-2">ID</th>
                            <th class="px-4 py-2">{% translate "Fecha/Hora" %}</th>
                            {% if request.user.is_staff or request.user.is_superuser %}
                                <th class="px-4 py-2">{% translate "Usuario" %}</th>
                            {% endif %}
                            <th class="px-4 py-2">{% translate "Acción" %}</th>
                            <th class="px-4 py-2">{% translate "Detalle" %}</th>
                            <th class="px-4 py-2">IP</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr class="hover:bg-blue-50 transition">
                            <td class="px-4 py-2 font-mono text-xs">#{{ log.pk }}</td>
                            <td class="px-4 py-2">{{ log.timestamp|date:"j M, Y H:i:s" }}</td>
                            {% if request.user.is_staff or request.user.is_superuser %}
                                <td class="px-4 py-2"><strong>{{ log.user.email }}</strong></td>
                            {% endif %}
                            <td class="px-4 py-2">
                                {% if log.action == 'NOTE_CREATED' %}
                                    <span class="badge badge-primary bg-blue-200 text-blue-800 px-2 py-1 rounded-full">
                                        {% translate "Nota Creada" %}
                                    </span>
                                {% elif log.action == 'NOTE_UPDATED' %}
                                    <span class="badge bg-blue-300 text-blue-900 px-2 py-1 rounded-full">
                                        {% translate "Nota Actualizada" %}
                                    </span>
                                {% elif log.action == 'NOTE_DELETED' %}
                                    <span class="badge badge-danger bg-red-200 text-red-800 px-2 py-1 rounded-full">
                                        {% translate "Nota Eliminada" %}
                                    </span>
                                {% elif log.action == 'LOGIN' %}
                                    <span class="badge badge-outline bg-blue-50 text-blue-700 px-2 py-1 rounded-full">
                                        {% translate "Inicio de Sesión" %}
                                    </span>
                                {% elif log.action == 'LOGOUT' %}
                                    <span class="badge badge-outline bg-blue-50 text-blue-700 px-2 py-1 rounded-full">
                                        {% translate "Cierre de Sesión" %}
                                    </span>
                                {% elif log.action == 'SIGNUP' %}
                                    <span class="badge badge-success bg-green-200 text-green-800 px-2 py-1 rounded-full">
                                        {% translate "Registro" %}
                                    </span>
                                {% else %}
                                    <span class="badge bg-gray-100 text-gray-700 px-2 py-1 rounded-full">
                                        {{ log.get_action_display|default:log.action }}
                                    </span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-2">
                                {% if log.note_title %}
                                    <span>{% translate "Nota" %}: <strong>"{{ log.note_title }}"</strong></span>
                                {% elif log.extra %}
                                    <span class="text-muted">{{ log.extra }}</span>
                                {% else %}
                                    <span class="text-muted">N/A</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-2 font-mono text-xs">{{ log.ip_address|default:"N/A" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center p-8">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="mx-auto mb-4 text-blue-200">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <p class="text-muted">{% translate "Aún no hay registros de actividad para mostrar." %}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.table-container {
    overflow-x: auto;
}

.table th, .table td {
    text-align: left;
    padding: 0.75rem 1rem;
}

.table th {
    font-weight: 600;
}

.badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
    font-weight: 600;
}
</style>
{% endblock content %}
