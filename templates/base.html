{% load static %}
<!DOCTYPE html>

{% if user.is_authenticated and user.theme == "dark" %}
<html lang="es" data-theme="oscuro">
{% else %}
<html lang="es" data-theme="claro">
{% endif %}

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block head_title %}NoteSafe{% endblock %}</title>

    <!-- Estilos principales -->
    <link rel="stylesheet" href="{% static 'css/notesafe-styles.css' %}">

    <!-- Animaciones e interfaz -->
    <style>
        /* NAVBAR */
        header {
            background: var(--bg-card);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .main-nav {
            max-width: 1200px;
            margin: auto;
            padding: 0.8rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* LOGO */
        .logo {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
            transition: 0.2s ease-in-out;
        }
        .logo:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        /* NAV LINKS */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            padding: 0.5rem 0.8rem;
            border-radius: var(--radius);
            transition: 0.2s ease-in-out;
        }

        .nav-links a:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        /* BOTONES */
        .btn-primary {
            background: var(--primary);
            color: white !important;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            transition: 0.2s ease-in-out;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }

        .btn-ghost:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .btn-danger:hover {
            background: #b30000;
        }

        /* MEN√ö USUARIO DROPDOWN */
        .user-menu {
            position: relative;
        }

        .user-menu-button {
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-light);
            border: 1px solid var(--border);
        }

        .dropdown {
            position: absolute;
            right: 0;
            margin-top: 8px;
            background: var(--bg-card);
            box-shadow: var(--shadow-lg);
            border-radius: var(--radius);
            display: none;
            flex-direction: column;
            width: 180px;
            overflow: hidden;
        }

        .dropdown a {
            padding: 0.7rem 1rem;
            border-bottom: 1px solid var(--border);
            transition: 0.2s ease-in-out;
        }

        .dropdown a:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        /* FOOTER */
        footer {
            margin-top: 4rem;
            padding: 1.5rem;
            text-align: center;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
        }

        /* RESPONSIVE MENU */
        .menu-toggle {
            display: none;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .nav-links.active {
                display: flex;
                flex-direction: column;
                background: var(--bg-card);
                padding: 1rem;
                position: absolute;
                top: 70px;
                right: 10px;
                width: 180px;
                box-shadow: var(--shadow-lg);
                border-radius: var(--radius);
            }

            .menu-toggle {
                display: block;
            }
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body>

<header>
    <nav class="main-nav">

        <!-- LOGO -->
        <a href="
            {% if user.is_authenticated %}
                {% if user.is_staff or user.is_superuser or user.role == 'admin' %}
                    {% url 'users:admin_home' %}
                {% else %}
                    {% url 'notes:note_list' %}
                {% endif %}
            {% else %}
                {% url 'account_login' %}
            {% endif %}
        " class="logo">
            <svg width="20" height="20" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586l6 6V19a2 2 0 01-2 2z" />
            </svg>
            <span>NoteSafe</span>
        </a>

        <!-- BOT√ìN MENU RESPONSIVE -->
        <div class="menu-toggle" onclick="toggleMenu()">
            <svg width="26" height="26" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>

        <!-- NAV LINKS -->
        <div class="nav-links" id="navLinks">

            {% if user.is_authenticated %}

                {% if user.is_staff or user.is_superuser or user.role == "admin" %}
                    <a href="{% url 'users:admin_home' %}">Inicio</a>
                    <a href="{% url 'admin:users_user_changelist' %}">Gesti√≥n Usuarios</a>
                {% else %}
                    <a href="{% url 'notes:note_list' %}">Mis Notas</a>
                {% endif %}

                <a href="{% url 'notes:audit_log' %}">Auditor√≠a</a>

                <!-- MEN√ö USUARIO -->
                <div class="user-menu">
                    <div class="user-menu-button" onclick="toggleUserMenu()">
                        üë§ {{ user.nombre|capfirst }}
                    </div>

                    <div class="dropdown" id="userDropdown">
                        <a href="{% url 'users:profile_detail' %}">Mi Perfil</a>
                        <a href="{% url 'account_logout' %}">Cerrar Sesi√≥n</a>
                    </div>
                </div>

            {% else %}
                <a href="{% url 'account_login' %}" class="btn-ghost">Iniciar Sesi√≥n</a>
                <a href="{% url 'account_signup' %}" class="btn-primary">Registrarse</a>
            {% endif %}
        </div>

    </nav>
</header>

<main>
    {% block content %}{% endblock %}
</main>

<footer>
    {% now "Y" as current_year %}
    <p>&copy; {{ current_year }} NoteSafe ‚Äî Todos los derechos reservados.</p>
</footer>

<!-- JS PARA INTERACTIVIDAD -->
<script>
    function toggleMenu() {
        document.getElementById("navLinks").classList.toggle("active");
    }

    function toggleUserMenu() {
        let dd = document.getElementById("userDropdown");
        dd.style.display = dd.style.display === "flex" ? "none" : "flex";
    }

    // Cerrar cuando se hace clic fuera
    document.addEventListener("click", function(e) {
        let dropdown = document.getElementById("userDropdown");
        let menuBtn = document.querySelector(".user-menu-button");

        if (!menuBtn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.style.display = "none";
        }
    });
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
